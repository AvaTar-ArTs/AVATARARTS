
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Python Script for Image Renaming and Copying</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <header class="site-header">
    <a class="brand" href="/index.html">üóÑÔ∏è Markdown Archive</a>
    <nav>
      <a href="/index.html">Home</a>
      <a href="/search.html">Search</a>
      <a href="https://quantumforgelabs.org" target="_blank" rel="noopener">QuantumForgeLabs</a>
    </nav>
  </header>
  <main class="content">
    <h1 id="python-script-for-image-renaming-and-copying">Python Script for Image Renaming and Copying</h1>
<blockquote>
<p><strong>User:</strong> simplify this into one code and as an image</p>
<p><strong>Assistant (thinking):</strong> Alright, let's tackle this problem. The user has provided multiple code snippets from different image files, and they want me to combine them into a single Python script. The goal is to create a unified code that renames image files based on their content using OpenAI's API, copies the renamed files to a specified directory, and logs the changes in a CSV file.
First, I need to review each image's content to understand what each part does. Let's list out the key components from each file:
1. <strong>IMG_1257.jpeg</strong>: Contains code for generating a new filename, renaming the file, copying it to a changed directory, and logging the results.
2. <strong>IMG_1259.jpeg</strong>: Imports necessary libraries, loads the OpenAI API key, and starts a function to generate filenames using OpenAI's image API.
3. <strong>IMG_1255.jpeg</strong>: Another version of the filename generation function using OpenAI's ChatCompletion.
4. <strong>IMG_1260.jpeg</strong>: Continuation of the filename generation, handling the response, and starting the function to rename files in a directory.
5. <strong>IMG_1258.jpeg</strong>: Code for writing results to a CSV and the main function setup.
6. <strong>IMG_1261.jpeg</strong>: More renaming logic and CSV writing, along with the main function setup.
7. <strong>IMG_1262.jpeg</strong>: Error message handling.
8. <strong>IMG_1256.jpeg</strong>: Error handling in the filename generation and the start of the rename and copy function.
Now, I need to merge these snippets into a single, coherent script. Here are the steps I should follow:
1. <strong>Combine Imports</strong>: Ensure all necessary libraries are imported once (os, csv, shutil, openai, dotenv, PIL.Image).
2. <strong>API Key Setup</strong>: Load the API key from the .env file using dotenv.
3. <strong>Generate Filename Function</strong>: Merge the different versions of the filename generation functions. It seems there are two approaches: using <code>openai.image.create_edit</code> and <code>openai.ChatCompletion.create</code>. The ChatCompletion approach with GPT-3.5-turbo seems more viable as it's text-based.
4. <strong>Rename and Copy Function</strong>: Integrate the logic for renaming files, checking extensions, handling errors, copying to a new directory, and logging results.
5. <strong>CSV Writing</strong>: Ensure the CSV is correctly formatted with headers and all necessary data (old path, new path, copied path).
6. <strong>Main Function</strong>: Set up the main function with directory paths and error checks.
7. <strong>Error Handling</strong>: Make sure all exceptions are caught and properly logged.
8. <strong>Testing</strong>: Ensure that the code flows logically and handles edge cases like invalid directories or API errors.
Potential issues to watch out for:
- <strong>Inconsistent Variable Names</strong>: Different snippets might use different variable names for the same entities. Need to standardize them.
- <strong>Function Definitions</strong>: Some snippets have partial function definitions. Need to complete them.
- <strong>API Usage</strong>: Correctly using OpenAI's API endpoints based on the chosen method (ChatCompletion vs. image editing).
- <strong>File Extensions Handling</strong>: Ensure all image extensions (jpg, jpeg, png) are correctly checked.
- <strong>Path Handling</strong>: Use os.path functions to handle file paths correctly across different operating systems.
After merging, I'll need to structure the code properly, indent correctly, and test for syntax errors. Finally, present the complete code as per the user's request.</p>
</blockquote>
<p>Here's the consolidated Python script combining all functionalities:</p>
<pre><code class="language-python">import os
import csv
import shutil
import openai
from dotenv import load_dotenv
from PIL import Image

# Load API Key from .env

load_dotenv()
openai.api_key = os.getenv(&quot;OPENAI_API_KEY&quot;)

def generate_filename_from_image(filepath):
    &quot;&quot;&quot;Generate descriptive filename using OpenAI GPT-3.5-turbo&quot;&quot;&quot;
    try:

        # Validate image file

‚Äã        with Image.open(filepath) as img:
‚Äã            img.verify()

        # Generate filename description
        response = openai.ChatCompletion.create(
            model=&quot;gpt-3.5-turbo&quot;,
            messages=[
                {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;Generate concise, descriptive filenames for images. Use only lowercase with underscores, no special characters.&quot;},
                {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: f&quot;Create a short filename describing this image: {os.path.basename(filepath)}. Respond only with the filename.&quot;}
            ]
        )

        description = response.choices[0].message[&quot;content&quot;].strip()
        return description.replace(&quot; &quot;, &quot;_&quot;).replace(&quot;/&quot;, &quot;_&quot;).lower()

    except Exception as e:
        print(f&quot;Error processing {filepath}: {e}&quot;)
        return None

def rename_and_copy_files(directory, output_csv, changed_files_dir):
    &quot;&quot;&quot;Process images and rename based on content&quot;&quot;&quot;
    image_exts = ('.jpg', '.jpeg', '.png')
    results = []


    if not os.path.exists(changed_files_dir):
        os.makedirs(changed_files_dir)

    for root, _, files in os.walk(directory):
        for file in files:
            if file.lower().endswith(image_exts):
                filepath = os.path.join(root, file)
                print(f&quot;Processing: {filepath}&quot;)

                new_filename = generate_filename_from_image(filepath)
                if not new_filename:
                    print(f&quot;Skipped: {filepath}&quot;)
                    continue

                ext = os.path.splitext(file)[1]
                new_path = os.path.join(root, f&quot;{new_filename}{ext}&quot;)

                if filepath != new_path:
                    # Rename file
                    os.rename(filepath, new_path)
                    # Copy to changed directory
                    copy_path = os.path.join(changed_files_dir, f&quot;{new_filename}{ext}&quot;)
                    shutil.copy(new_path, copy_path)

                    results.append([filepath, new_path, copy_path])
                    print(f&quot;Renamed: {file} -&gt; {new_filename}{ext}&quot;)

    # Save results to CSV
    with open(output_csv, 'w', newline='') as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(['Original Path', 'New Path', 'Copy Path'])
        writer.writerows(results)
    print(f&quot;Process completed! Results saved to {output_csv}&quot;)

if __name__ == &quot;__main__&quot;:
    SOURCE_DIR = &quot;/Users/steven/Pictures/myDesign&quot;
    OUTPUT_CSV = &quot;/Users/steven/Desktop/renaming_results.csv&quot;
    CHANGED_DIR = &quot;/Users/steven/Downloads/changed_files/&quot;

if os.path.exists(SOURCE_DIR):
    rename_and_copy_files(SOURCE_DIR, OUTPUT_CSV, CHANGED_DIR)
else:
    print(&quot;Error: Source directory does not exist&quot;)
</code></pre>
<p>Key features:</p>
<ol>
<li>Single script combining all functionalities</li>
<li>Uses GPT-3.5-turbo for filename generation</li>
<li>Validates images before processing</li>
<li>Handles file renaming and copying</li>
<li>Maintains detailed CSV log</li>
<li>Proper error handling and logging</li>
<li>Case normalization and special character replacement
   To use:</li>
<li>Create<code>.env</code>file with<code>OPENAI_API_KEY=your_api_key</code></li>
<li>Install requirements:<code>pip install python-dotenv openai pillow</code></li>
<li>Update directory paths in<code>__main__</code>section</li>
<li>
<p>Run script:<code>python image_renamer.py</code>
    The script will:</p>
</li>
<li>
<p>Process all JPG/JPEG/PNG files in source directory</p>
</li>
<li>Generate descriptive filenames using AI</li>
<li>Rename originals and copy to changed directory</li>
<li>Create CSV log of all changes</li>
</ol>
<blockquote>
<p><strong>Assistant (thinking):</strong> Okay, let me try to figure out what the user is asking here. They previously provided several code snippets from different image files, and I combined them into a single Python script. Now their query is "as am image". Hmm, that's probably a typo. Maybe they meant "as an image"?
So, they want the consolidated code presented as an image. Maybe they can't upload files where they are, so an image of the code would be easier for them to use. Alternatively, they might want a visual representation of the code structure.
First, I need to confirm if they want the code in an image format, like a screenshot. Since I can't generate actual images, I can describe how to create one or use a code formatting service. Alternatively, maybe they want the code embedded within an image file, but again, I can't create that here.
Wait, in their initial request, they said "simplify this into one code and as an image". The assistant provided the code, and now the user is responding with "as am image", which is likely "as an image". They might have expected the code to be in an image format instead of text. But since I can't generate images, perhaps I should explain that and offer to format the code nicely or provide steps to create the image themselves.
Alternatively, maybe they want a flowchart or diagram of the code's structure. That would be an image explaining the code's workflow. I can describe how to create such a diagram using tools like draw.io or Lucidchart.
But considering the user's previous interaction, they probably just want the code in an image file. Since I can't do that, I should inform them and offer alternatives, like providing the code in a formatted text block or instructing them to copy the code into a text editor and save it as a file. Also, mention that they can take a screenshot themselves if they need it as an image.
Wait, looking back, the assistant's previous response included the code in a markdown block. The user might have issues viewing or copying that, so they want it as an image. But again, I can't generate images. So the best approach is to apologize and explain that I can't create images, but offer to help with the code in another way, like re-providing it in a different format or answering any questions about it.
Alternatively, maybe the user made a mistake in their query. "as am image" could be a typo. Maybe they meant "as an image" but mistyped. So I should proceed under that assumption.
In summary, the user wants the consolidated code presented as an image. Since I can't generate images, I should explain that limitation and offer the code in a text format again, perhaps with better formatting. Also, suggest tools they can use to convert the text to an image themselves, like taking a screenshot or using online converters.</p>
</blockquote>
<ol>
<li><strong>Copy this code</strong>‚Üí Paste into a text editor (e.g., VS Code) ‚Üí Save as<code>image_renamer.py</code></li>
<li><strong>Screenshot it</strong>directly from this message.</li>
<li>Use tools like<strong>Carbon</strong>to create a stylized code image.</li>
</ol>
<pre><code class="language-python">import os
import csv
import shutil
import openai
from dotenv import load_dotenv
from PIL import Image

load_dotenv()
openai.api_key = os.getenv(&quot;OPENAI_API_KEY&quot;)

def generate_filename_from_image(filepath):
    &quot;&quot;&quot;Generate filename using OpenAI GPT-3.5-turbo&quot;&quot;&quot;
    try:
        with Image.open(filepath) as img:
            img.verify()  # Validate image integrity

        response = openai.ChatCompletion.create(
            model=&quot;gpt-3.5-turbo&quot;,
            messages=[
                {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;Generate concise, lowercase filenames with underscores.&quot;},
                {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: f&quot;Create a filename for: {os.path.basename(filepath)}. Respond ONLY with the filename.&quot;}
            ]
        )
        description = response.choices[0].message[&quot;content&quot;].strip()
        return description.replace(&quot; &quot;, &quot;_&quot;).replace(&quot;/&quot;, &quot;_&quot;).lower()
    except Exception as e:
        print(f&quot;Error processing {filepath}: {e}&quot;)
        return None

def rename_and_copy_files(directory, output_csv, changed_files_dir):
    &quot;&quot;&quot;Rename images and copy changes&quot;&quot;&quot;
    image_exts = ('.jpg', '.jpeg', '.png')
    results = []

    if not os.path.exists(changed_files_dir):
        os.makedirs(changed_files_dir)

    for root, _, files in os.walk(directory):
        for file in files:
            if file.lower().endswith(image_exts):
                filepath = os.path.join(root, file)
                new_filename = generate_filename_from_image(filepath)
                if not new_filename:
                    continue  # Skip on error

                ext = os.path.splitext(file)[1]
                new_path = os.path.join(root, f&quot;{new_filename}{ext}&quot;)

                if filepath != new_path:
                    os.rename(filepath, new_path)  # Rename original
                    copy_path = os.path.join(changed_files_dir, f&quot;{new_filename}{ext}&quot;)
                    shutil.copy(new_path, copy_path)  # Copy to new dir
                    results.append([filepath, new_path, copy_path])

    # Save CSV log
    with open(output_csv, 'w', newline='') as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(['Original Path', 'New Path', 'Copy Path'])
        writer.writerows(results)
    print(f&quot;Results saved to {output_csv}&quot;)

if __name__ == &quot;__main__&quot;:
    SOURCE_DIR = &quot;/path/to/your/images&quot;
    OUTPUT_CSV = &quot;/path/to/results.csv&quot;
    CHANGED_DIR = &quot;/path/to/changed_files&quot;

    if os.path.exists(SOURCE_DIR):
        rename_and_copy_files(SOURCE_DIR, OUTPUT_CSV, CHANGED_DIR)
    else:
        print(&quot;Error: Source directory missing&quot;)

</code></pre>
  </main>
  <footer class="site-footer">
    <div>Generated by <code>build_archive.py</code>. No trackers. Pure static HTML.</div>
  </footer>
</body>
</html>